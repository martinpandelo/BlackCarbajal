
<form [formGroup]="eventForm" (ngSubmit)="onSubmit()">

<!-- Barra sticky dentro del form -->
<div
  class="sticky top-0 z-40 bg-base-100/90 backdrop-blur border-b border-base-300
         px-4 lg:px-8 py-3">
  <div class="flex items-center gap-3">
    <h1 class="flex-1 text-2xl lg:text-3xl font-bold truncate">
      @if ( event().title ) {
        {{ event().title }}
      } @else {
        Nueva Noticia
      }
    </h1>

    <button class="btn btn-primary btn-lg" type="submit">
      @if (isLoading()) {
        <span class="loading loading-spinner loading-sm"></span>
        Guardando...
      } @else {
        Guardar
      }
    </button>
  </div>
</div>

<div class="grid grid-cols-1 sm:grid-cols-2 gap-20 px-4 lg:px-8 pt-10">

  <!-- Datos generales -->
  <div class="flex flex-col">
    <h2 class="text-xl font-bold">Datos generales</h2>

    <div class="divider"></div>

    <fieldset class="fieldset">
      <legend class="fieldset-legend">Título</legend>
      <input
        type="text"
        class="input input-bordered w-full"
        placeholder="Título"
        formControlName="title"
        [class.border-error]="formUtils.isValidField(eventForm, 'title')"
         />
        <form-error-label [control]="eventForm.get('title')!" fieldName="title" />
    </fieldset>


    <fieldset class="fieldset">
      <legend class="fieldset-legend">Slug</legend>
      <input
        type="text"
        placeholder="Slug"
        class="input input-bordered w-full"
        formControlName="slug"
        [class.border-error]="formUtils.isValidField(eventForm, 'slug')"
      />
      <form-error-label [control]="eventForm.get('slug')!" fieldName="slug" />
    </fieldset>


    <fieldset class="fieldset">
      <legend class="fieldset-legend">Descripción</legend>
      <textarea
        class="textarea textarea-bordered w-full"
        placeholder="Descripción"
        rows="6"
        formControlName="description"
        [class.border-error]="formUtils.isValidField(eventForm, 'description')"
      ></textarea>
      <form-error-label [control]="eventForm.get('description')!" fieldName="description" />
    </fieldset>

  </div>

  <!-- Imágenes -->
  <div class="flex flex-col gap-2">
    <image-carousel [imagesCarousel]="event().images" [imageType]="'eventos'" />

    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mt-4">
      @for (image of eventForm.value.images; track $index) {
        <div class="relative group">
          <img [src]="image | pathImage:'eventos'" alt="Imagen" class="w-full object-cover rounded-xl">
          <button type="button"
              (click)="removeExistingImage(image)"
              class="absolute top-1 right-1 btn btn-xs btn-error opacity-0 group-hover:opacity-100 transition-opacity">
            ✕
          </button>
        </div>
      }
    </div>

    <input
      type="file"
      multiple
      accept="image/*"
      class="file-input file-input-primary w-full mt-4"
      (change)="onFilesChanged($event)"
    />

    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mt-4">
      @for (image of tempImages(); track $index) {
        <div class="relative group">
          <img [src]="image" alt="Imagen temporal" class="w-full object-cover rounded-xl">
          <button type="button"
                  (click)="removeTempImage($index)"
                  class="absolute top-1 right-1 btn btn-xs btn-error opacity-0 group-hover:opacity-100 transition-opacity">
            ✕
          </button>
        </div>
      }
    </div>

  </div>
  <!--Fin imagenes-->

</div>

</form>

@if (wasSaved()) {
  <div class="toast toast-top toast-center z-42">
    <div class="alert alert-success">
      <span>{{ successMessage() }}</span>
    </div>
  </div>
}
