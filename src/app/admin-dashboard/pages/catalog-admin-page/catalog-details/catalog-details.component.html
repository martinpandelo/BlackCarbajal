
<form [formGroup]="catalogForm" (ngSubmit)="onSubmit()">

<!-- Barra sticky dentro del form -->
<div class="sticky top-0 z-40 bg-base-100/90 backdrop-blur border-b border-base-300 px-4 lg:px-8 py-3">
  <div class="flex items-center gap-3">
    <h1 class="flex-1 text-2xl lg:text-3xl font-bold truncate">
      @if ( catalog().title ) {
        {{ catalog().title }}
      } @else {
        Nuevo catálogo
      }
    </h1>

    <button class="btn btn-primary btn-lg" type="submit">
      @if (isLoading()) {
        <span class="loading loading-spinner loading-sm"></span>
        Guardando...
      } @else {
        Guardar
      }
    </button>
  </div>
</div>

<div class="grid grid-cols-1 sm:grid-cols-3 gap-15 px-4 lg:px-8 pt-10">

  <!-- Datos generales -->
  <div class="col-span-2">

    <fieldset class="fieldset">
      <legend class="fieldset-legend">Título</legend>
      <input
        type="text"
        class="input input-bordered w-full"
        placeholder="Título"
        formControlName="title"
        [class.border-error]="formUtils.isValidField(catalogForm, 'title')"
         />
        <form-error-label [control]="catalogForm.get('title')!" fieldName="title" />
    </fieldset>

    <fieldset class="fieldset">
      <legend class="fieldset-legend">Link</legend>
      <input
        type="text"
        placeholder="Link"
        class="input input-bordered w-full"
        formControlName="link"
        [class.border-error]="formUtils.isValidField(catalogForm, 'link')"
      />
      <form-error-label [control]="catalogForm.get('link')!" fieldName="link" />
    </fieldset>


  </div>

  <!-- Imágenes -->
  <div class="flex flex-col gap-2">

      <div  class="relative group">
        <img
          [src]="catalogForm.value.image | pathImage:'catalogos'"
          alt="Imagen"
          class="w-full object-cover rounded-xl"
        />
        @if (catalogForm.value.image) {
        <button
          type="button"
          (click)="removeImage()"
          class="absolute top-1 right-1 btn btn-xs btn-error opacity-0 group-hover:opacity-100 transition-opacity">
          ✕
        </button>
        }
      </div>


    <!-- Input file -->
    <input
      type="file"
      accept="image/*"
      class="file-input file-input-primary w-full mt-4"
      (change)="onFilesChanged($event)"
    />

  </div>
  <!--Fin imagenes-->

</div>

</form>

@if (wasSaved()) {
  <div class="toast toast-top toast-center z-42">
    <div class="alert alert-success">
      <span>{{ successMessage() }}</span>
    </div>
  </div>
}
